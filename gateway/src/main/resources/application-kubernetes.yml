spring:
  cloud:
    kubernetes:
      discovery:
        enabled: true
    loadbalancer:
      ribbon:
        enabled: false
    gateway:
      x-forwarded:
        enabled: true
        for-enabled: true
        proto-enabled: true
        host-append: false
        port-append: false
        proto-append: false
      routes:
        - id: accounts-service
          uri: https://accounts-service.ersms-forum.svc.cluster.local:8081
          predicates:
            - Path=/accounts/**
        - id: posts-service
          uri: https://posts-service.ersms-forum.svc.cluster.local:8082
          predicates:
            - Path=/posts/**
        - id: threads-service
          uri: https://threads-service.ersms-forum.svc.cluster.local:8083
          predicates:
            - Path=/threads/**
        - id: kibana
          uri: https://eck-stack-eck-kibana-kb-http.default.svc.cluster.local:5601
          predicates:
            - Path=/kibana/**
        - id: prometheus
          uri: http://prometheus-stack-kube-prom-prometheus.default.svc.cluster.local:9090
          predicates:
            - Path=/prometheus/**
        - id: grafana
          uri: http://prometheus-stack-grafana.default.svc.cluster.local:80
          predicates:
            - Path=/grafana/**
        - id: keycloak
          uri: http://keycloak.ersms-forum.svc.cluster.local:8888
          predicates:
            - Path=/keycloak/**
        - id: frontend
          uri: http://frontend.ersms-forum.svc.cluster.local:8084
          predicates:
            - Path=/**
            - NotPath=/swagger,/swagger/**,/webjars/**,/actuator/**
      httpclient:
        ssl:
          trusted-x509-certificates:
            - classpath:client.pem
          useInsecureTrustManager: true

# TODO: add support for generated ssl certificate

server:
  ssl:
    enabled: true
    key-alias: server
    key-store: classpath:server.p12
    key-store-type: PKCS12
    key-password: secret
    key-store-password: secret
    trust-certificate: classpath:client.pem
